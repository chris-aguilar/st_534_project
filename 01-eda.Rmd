# Exploratory Data Analyis 

We start by doing some exploratory data (EDA) analysis on our data.

## Data import and preview

We'll need to import the aviation incident data first. Then we'll preview the first 10 quarters.

```{r eda import, message=FALSE, echo=TRUE}
library(dplyr)
library(readr)
library(fpp3)
library(knitr)

aviation_data <- read_csv("aviation_incident_data_clean.csv") |>
  mutate(year_qtr = yearquarter(year_qtr)) |>
  as_tsibble(index=year_qtr)

kable(aviation_data |> head(10), col.names = c("Quarter", "Events"))
```

## Data visualization

We begin by plotting the aviation incident time series itself along with the relevant ACF and PACF plots.

```{r data viz}

aviation_data |>
  gg_tsdisplay(n, plot_type = "partial") +
  labs(title = "Aviation incident series plot and ACF, PACF plots")

```

The last point in the series is an unusual observation. This point corresponds to Q4 2025. This data for analysis was collected 2025-10-28, meaning the final observation only has four weeks of data, not an entire quarter. So we'll drop that point from analysis.

It also seems like the incident variance is not constant over time. This is shown by the smaller amplitudes toward the end of the series. So we'll make use of a log-transformation to stabilize variance.

Next, we notice the ACF plot has large spikes at lag multiples of 4 and these die out very slowly. We're very likely going to need a seasonal differencing at lag of 4 to account for this strong seasonal pattern.

We also see there's a downward trend. We might need lag-1 differencing to account for this, if our seasonally-differenced series does not become stationary.

We'll filter away the final point, create a log-transformed incident count, a seasonal difference of the log-transform, a lag-1 difference of the log transform, and a combination of the differences on the log-transform.

We'll start by visualizing the series with a log-transform first.

```{r logtransform data viz}

# creating differenced series at lags 4, 1, and 4+1
aviation_data <- aviation_data |>
  filter_index(. ~ "2025 Q3") |> # everything up to Q3 2025 to omit partial Q4
  mutate(
    log_n = log(n), # for variance stabilization
    sdiff_logn = difference(log_n, 4), # seasonal difference
    diff_logn = difference(log_n), # lag-1 difference
    double_diff_logn = difference(diff_logn, 4) # seasonal diff on simple diff
    )

aviation_data |>
  gg_tsdisplay(log_n, plot_type = "partial", lag_max = 24) +
  labs(title = "Log-transformed aviation incident series plot and ACF, PACF plots", 
       subtitle = "Variance appears stabilized")
```

After transforming our response variable, it's clear to see variance now appears stable.

Next, we check a lag-1 difference to see if any other seasonal pattern is masked in our ACF/PACF plots.

```{r lag1 diff and plot check, warning=FALSE}

aviation_data |>
  gg_tsdisplay(difference(log_n), plot_type = "partial") +
  labs(title = "Log-aviation incidents after a simple difference",
       subtitle = "Strong seasonal pattern evident")
```

It's clear that there's a strong seasonal pattern based on the differenced series and ACF plots. 

Next, we check visually after incorporating a seasonal lag of 4 but no lag-1 difference. We're curious to see if the series becomes stationary after a single seasonal difference.

```{r seasonal lag visuals, warning=FALSE}

aviation_data |>
  gg_tsdisplay(difference(log_n, 4), plot_type = "partial", lag_max = 24) +
  labs(title = "Log-aviation incidents after a lag-4 difference")
```

The series looks pretty close to stationary seeing as how there appears to be no trend or pattern in the differenced series plot, and the most of the seasonal ACF spikes disappear. We'll check with an ADF test.

```{r adf, message=FALSE, warning=FALSE}
library(tseries)

# lag-4 adf
aviation_data |>
  filter(!is.na(sdiff_logn)) |> # no NA's allowed for ADF test
  pull(sdiff_logn) |>
  adf.test(k = 4) # test at lag 4 due to quarterly seasonality

```

Based on the ADF test, a single seasonal difference at lag 4 is enough to make our series stationary.

We also check to see if we can reject the Ljung-Box null hypothesis of white noise.

```{r sdiff white noise check}
aviation_data |>
  filter(!is.na(sdiff_logn)) |> # base-R Ljung-Box test expects no NAs
  pull(sdiff_logn) |>
  Box.test(lag = 8, type = "Ljung-Box") # 2 * seasonal period = 8

```

The Ljung-Box test suggests the lag-4 differenced series is not white noise, so we should do some modeling to make use of more information in the series.

Looking at seasonal lag components of the **Lag-4 difference series, ACF and PACF plots**, we notice that the ACF plot has significant spikes into the teens and 20. We also notice the PACF plot has no more significant spikes after lag 8, corresponding to a seasonal lag of 2. The fact that the ACF plot continues to have spikes at later lags but the PACF plot stops after lag 8 suggests a non-seasonal AR portion. But also, the PACF still looks a little bit like it dies off slowly. So this suggests both a seasonal AR and MA component will be needed as well. 

So, since we took one seasonal difference, we fix $D=1$. For simplicity's sake, we're going to guess $p=3$ based on the significant PACF spike at lag 3. So we'll just play around with $P=[0, 1, 2]$, and leave $q=0$.

We leave $Q=1$ to account for the seasonal ARMA component, and since P and Q are rarely greater than 1. However, we allow $P=[0, 1, 2]$ to vary because of the PACF.

We'll also play with including a constant or not in the model. This is because the original series showed some slight downward trend, even though the lag-4 differenced series became stationary. With 171 observations, we have plenty of data to play with.

We'll also make use of a variation of the [Hyndman-Khandakar algorithm](https://otexts.com/fpp3/arima-r.html#how-does-arima-work) to automatically select a model by choosing parameters that minimize $AICc$, a corrected version of the $AIC$.

Thus, the candidate models using the log-transformed incident series are:

  - $ARIMA(3,0,0)\times(0,1,1)_4$ sans constant,
  - $ARIMA(3,0,0)\times(0,1,1)_4$ with a constant,
  - $ARIMA(3,0,0)\times(1,1,1)_4$ sans constant,
  - $ARIMA(3,0,0)\times(1,1,1)_4$ with a constant,
  - $ARIMA(3,0,0)\times(2,1,1)_4$ sans constant,
  - $ARIMA(3,0,0)\times(2,1,1)_4$ with a constant,
  - Some auto-selected seasonal ARIMA model, fixing $D=1$.
  
We'll go through the model fitting exercise next using these models.
