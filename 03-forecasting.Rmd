---
output:
  pdf_document: default
  html_document: default
---

# Forecasting

```{r forecasting data import, message=FALSE, warning=FALSE, echo=FALSE}
library(readr)
library(fpp3)
library(knitr)
library(ggtime)

# data import template for modeling section; this code is set to not show in 
# report
aviation_data <- read_csv("aviation_incident_data_clean.csv") |>
  mutate(year_qtr = yearquarter(year_qtr)) |>
  as_tsibble(index=year_qtr) |>
  filter_index(. ~ "2025 Q3") |> # dropping 2025 Q4 due to incomplete data
  mutate(
    log_n = log(n) # for variance stabilization
  )
```

We will use the best-fitting model, $ARIMA(3,0,0)\times(0,1,1)_4$, to generate forecasts for the next 3 years forecast.
```{r forecasting, message=FALSE, warning=FALSE, results='hide'}
library(fpp3)

fit <- aviation_data |>
  model(
    arima_3_0_0_0_1_1_4 = ARIMA(
      log_n ~ pdq(3, 0, 0) + PDQ(0, 1, 1, 4)
    )
  )

# Forecast the next 12 quarters (3 years)
fc <- fit |>
  forecast(h = 12)

```

```{r}
library(knitr)

fc |>
  as_tibble() |>
  select(year_qtr, log_n,.mean)|>
  kable(digits = 3, caption = "3-year forecasts from ARIMA(3,0,0) x (0,1,1)[4]")

```

Using `autoplot()` function to generate a plot of 3-year ahead forecasts

```{r}
fc |>
  autoplot(level=95) +
  autolayer(aviation_data, log_n) +
  labs(
    title = "Forecasts from ARIMA(3,0,0) X (0,1,1)[4]",
    y = "Number of incidents (log scale)",
    x = "Year-quarter"
  )

```

The model predicts that aviation incident counts will remain stable over the next three years, with seasonal variation following the historical quarterly pattern. The forecast doesn't indication increase in aviation incidence frequency in the near future. This may reflect steady aviation safety practice. 